(()=>{"use strict";var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var n in e)t.o(e,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:e[n]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};const a=window.jQuery;var e=t.n(a);e()((function(){const t=e()("#richmenu-image-svg"),a=t.find(".area-lines"),n=t.find(".area-texts"),o=e()("#richmenu-area-list tbody"),r=wp.template("area-settings"),i=e()("#richmenu-action-list tbody"),s=wp.template("action-settings");if(void 0!==t){const a=t.data("bg"),e=new Image;e.onload=function(){t.data("ratio",t.parent().width()/parseInt(t.data("width")));const e=parseInt(t.data("width"))*t.data("ratio"),n=parseInt(t.data("height"))*t.data("ratio");t.attr({width:e,height:n,viewBox:`0 0 ${e} ${n}`}),t.find("#bg-pattern").attr({width:e,height:n}),t.find("#bg-pattern image").attr({width:e,height:n,href:a}),l()},e.src=a}const l=()=>{e().ajax({url:ajaxurl+"?action=ry-line/get-richmenu-areas",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.get}}).done((function(t){t.success&&Array.isArray(t.data.areas)&&t.data.areas.length?m(t.data.areas):f()}))};e()(".ry-reset-areas").on("click",(function(){a.empty(),f()})),e()(".ry-save-position").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/save-richmenu-areas",method:"POST",dataType:"json",data:{areas:decodeURIComponent(e()("#richmenu-area-list").serialize()),post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.areas}}).done((function(t){t.success&&Array.isArray(t.data)&&t.data.length?m(t.data):f()})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-save-action").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/save-richmenu-actions",method:"POST",dataType:"json",data:{actions:decodeURIComponent(e()("#richmenu-action-list").serialize()),post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.actions}}).done((function(t){t.success&&Array.isArray(t.data)&&t.data.length?m(t.data):f()})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-create-menu").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/remote-richmenu-create",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.create}}).done((function(t){t.success?location.reload():c(t.data)})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-set-alias").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/remote-richmenu-alias",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),alias:e()("#menu-alias").val(),_ajax_nonce:RYLineRichmenu.nonce.alias}}).done((function(t){t.success?e()("#menu-alias").val(t.data):c(t.data)})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-set-test").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/remote-richmenu-test",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.test}}).done((function(t){t.success||c(t.data)})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-default-menu").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/remote-richmenu-default",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.default}}).done((function(t){t.success?a.text(t.data):c(t.data)})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))})),e()(".ry-delete-menu").on("click",(function(t){if(t.isPropagationStopped())return;let a=e()(this);e().ajax({url:ajaxurl+"?action=ry-line/remote-richmenu-delete",method:"POST",dataType:"json",data:{post_id:e()("#post_ID").val(),_ajax_nonce:RYLineRichmenu.nonce.delete}}).done((function(t){t.success?location.reload():c(t.data)})).always((function(){a.parent().find("span.spinner").removeClass("is-active").remove()}))}));const c=function(t){let a=t.message;if(void 0!==t.details)for(const e of t.details)a+=`\n- ${e.message} ( ${e.property} )`;alert(a)};let d=!1,h=!1,u=null,p=null;e()(document).on("mouseup",(function(a){if(!d&&!h)return;if(h){p.removeClass("dragging");let t=v(a);return p.hasClass("horizontal")?p.attr({y1:t.y,y2:t.y,stroke:"#0000ff"}):p.attr({x1:t.x,x2:t.x,stroke:"#0000ff"}),x(),y(),h=!1,void(u=null)}t.removeClass(["drawing"]);let n=b(a);Math.abs(n.x-u.x)>Math.abs(n.y-u.y)?(n.y=u.y,p.addClass(["horizontal"])):(n.x=u.x,p.addClass(["vertical"])),Math.abs(u.x-n.x)+Math.abs(u.y-n.y)>20&&w(n.x,n.y)?(p.removeClass(["temp-line"]).addClass(["permanent-line"]).attr({x1:u.x,y1:u.y,x2:n.x,y2:n.y,stroke:"#0000ff","stroke-dasharray":""}),p.on("dblclick",(function(){e()(this).remove(),x()})),y()):p.remove(),d=!1,u=null,p=null}));const f=()=>{i.off("change"),t.find("rect.bg").attr("opacity",0),o.closest("table").show(),i.closest("table").hide(),e()(".ry-create-menu").hide(),t.on("mousedown",(function(n){n.preventDefault();const o=b(n);if(n.target.classList.contains("permanent-line"))return h=!0,u=o,p=e()(n.target),void p.addClass(["dragging"]);w(o.x,o.y)&&(t.addClass(["drawing"]),d=!0,u=o,p=e()(document.createElementNS("http://www.w3.org/2000/svg","line")),p.addClass(["temp-line"]).attr({x1:u.x,y1:u.y,x2:u.x,y2:u.y,stroke:"#ff0000","stroke-width":2,"stroke-dasharray":"5,5"}),a.append(p))})),t.on("mousemove",(function(t){if(!d&&!h)return;if(h){let a=v(t);return p.hasClass("horizontal")?p.attr({y1:a.y,y2:a.y,stroke:"#00ff00"}):p.attr({x1:a.x,x2:a.x,stroke:"#00ff00"}),void y()}let a=b(t);Math.abs(a.x-u.x)>Math.abs(a.y-u.y)?a.y=u.y:a.x=u.x,p.attr({x2:a.x,y2:a.y,stroke:w(a.x,a.y)?"#00ff00":"#ff0000"})})),y()},m=r=>{t.off("mousedown"),t.off("mousemove"),t.find("rect.bg").attr("opacity",.04),o.closest("table").hide(),i.closest("table").show(),e()(".ry-create-menu").hide(),i.empty(),n.empty(),i.on("change",".action-type",(function(){e()(this).closest("tr").find(".action-info").hide(),e()(this).closest("tr").find(".action-info-"+e()(this).val()).show()}));let l=!1;for(const n in r){const o=r[n];g((o.bounds.x+o.bounds.width/2)*t.data("ratio"),(o.bounds.y+o.bounds.height/2)*t.data("ratio"),n);const c=e()(document.createElementNS("http://www.w3.org/2000/svg","rect"));c.attr({x:o.bounds.x*t.data("ratio"),y:o.bounds.y*t.data("ratio"),width:o.bounds.width*t.data("ratio"),height:o.bounds.height*t.data("ratio"),fill:"none",stroke:"#0000ff","stroke-width":1}),a.append(c),i.append(s({idx:n,areaStart:`( ${o.bounds.x}, ${o.bounds.y} )`,areaSize:`${o.bounds.width} x ${o.bounds.height}`}));const d=i.find("tr").last();switch(d.find(".action-type").val(o.action.type).trigger("change"),o.action.type){case"uri":d.find(`#action-info-${n}-uri`).val(o.action.uri),d.find(`#action-info-${n}-label`).val(o.action.label),l=!0;break;case"message":d.find(`#action-info-${n}-text`).val(o.action.text),d.find(`#action-info-${n}-label`).val(o.action.label),l=!0;break;case"richmenuswitch":d.find(`#action-info-${n}-richMenuAliasId`).val(o.action.richMenuAliasId),l=!0}}l&&e()(".ry-create-menu").show()},y=()=>{const i=parseFloat(t.attr("width")),s=parseFloat(t.attr("height")),l=[];a.find("line.permanent-line").each((function(){l.push({x1:parseFloat(e()(this).attr("x1")),y1:parseFloat(e()(this).attr("y1")),x2:parseFloat(e()(this).attr("x2")),y2:parseFloat(e()(this).attr("y2"))})}));const c=new Set([0,i]),d=new Set([0,s]);l.forEach((t=>{c.add(t.x1),c.add(t.x2),d.add(t.y1),d.add(t.y2)}));const h=Array.from(c).sort(((t,a)=>t-a)),u=Array.from(d).sort(((t,a)=>t-a)),p={};for(let t=0;t<u.length-1;t++)for(let a=t+1;a<u.length;a++)for(let e=0;e<h.length-1;e++)for(let n=e+1;n<h.length;n++){let o=h[e],r=h[n],i=u[t],s=u[a];void 0===p[`${o}, ${i}`]&&j(o,i,r,s,l)&&(p[`${o}, ${i}`]={left:o,top:i,right:r,bottom:s})}o.empty(),n.empty(),Object.values(p).forEach(((a,e)=>{g((a.left+a.right)/2,(a.top+a.bottom)/2,e);const n=Math.floor(a.left/t.data("ratio")),i=Math.floor(a.top/t.data("ratio")),s=Math.floor(a.right/t.data("ratio")),l=Math.floor(a.bottom/t.data("ratio")),c=parseFloat(t.attr("width"))/t.data("ratio")/360;let d=Math.round((s-n)/c),h=Math.round((l-i)/c);d<30&&(d=`<strong class="file-error">${d}</strong>`),h<30&&(h=`<strong class="file-error">${h}</strong>`),o.append(r({idx:e,value:`${n?n+1:0}-${i?i+1:0}-${s-n}-${l-i}`,phoneSize:`${d} x ${h}`,areaStart:`( ${n?n+1:0} , ${i?i+1:0} )`,areaSize:`${s-n} x ${l-i}`}))}))},x=()=>{let t=[];if(a.find("line.permanent-line").each((function(){let a=e()(this);a.addClass(["pre-delete"]).removeClass(["permanent-line"]),w(a.attr("x1"),a.attr("y1"))&&w(a.attr("x2"),a.attr("y2"))?a.addClass(["permanent-line"]).removeClass(["pre-delete"]):t.push(a)})),t.length){for(;t.length;)t.pop().remove();x()}else y()},g=(t,a,o)=>{const r=e()(document.createElementNS("http://www.w3.org/2000/svg","circle"));r.attr({cx:t,cy:a,fill:"#000",opacity:"0.075"}),n.append(r);const i=e()(document.createElementNS("http://www.w3.org/2000/svg","text"));i.attr({x:t,y:a,dy:"2px","text-anchor":"middle","dominant-baseline":"middle"}),i.text(o),n.append(i),r.attr({r:Math.floor(Math.max(i[0].getBBox().width,i[0].getBBox().height)/2)})},v=a=>{const e=t[0].getBoundingClientRect(),n=parseFloat(t.attr("width")),o=parseFloat(t.attr("height"));return{x:(a.clientX-e.left)/e.width*n,y:(a.clientY-e.top)/e.height*o}},b=n=>{const o=parseFloat(t.attr("width")),r=parseFloat(t.attr("height"));let{x:i,y:s}=v(n);return i<=20&&(i=0),i>=o-20&&(i=o),s<=20&&(s=0),s>=r-20&&(s=r),a.find("line.permanent-line").each((function(){const t={x1:parseFloat(e()(this).attr("x1")),y1:parseFloat(e()(this).attr("y1")),x2:parseFloat(e()(this).attr("x2")),y2:parseFloat(e()(this).attr("y2"))};M(i,s,t,20)&&(Math.abs(t.y1-t.y2)<1?s=t.y1:Math.abs(t.x1-t.x2)<1&&(i=t.x1))})),{x:i,y:s}},w=(n,o)=>{const r=parseFloat(t.attr("width")),i=parseFloat(t.attr("height")),s=.1;if(n=parseFloat(n),o=parseFloat(o),n<=s||n>=r-s||o<=s||o>=i-s)return!0;let l=!1;return a.find("line.permanent-line").each((function(){const t={x1:parseFloat(e()(this).attr("x1")),y1:parseFloat(e()(this).attr("y1")),x2:parseFloat(e()(this).attr("x2")),y2:parseFloat(e()(this).attr("y2"))};M(n,o,t,s)&&(l=!0)})),l},M=(t,a,e,n)=>{const{x1:o,y1:r,x2:i,y2:s}=e;return Math.abs(r-s)<n?Math.abs(a-r)<=n&&t>=Math.min(o,i)-n&&t<=Math.max(o,i)+n:Math.abs(o-i)<n&&Math.abs(t-o)<=n&&a>=Math.min(r,s)-n&&a<=Math.max(r,s)+n},j=(t,a,e,n,o)=>{const r=.1,i=_(t,a,e,a,o,r),s=_(e,a,e,n,o,r),l=_(t,n,e,n,o,r),c=_(t,a,t,n,o,r);return i&&s&&l&&c},_=(a,e,n,o,r,i)=>{const s=parseFloat(t.attr("width")),l=parseFloat(t.attr("height"));if(Math.abs(e)<=i&&Math.abs(o)<=i||Math.abs(a)<=i&&Math.abs(n)<=i||Math.abs(e-l)<=i&&Math.abs(o-l)<=i||Math.abs(a-s)<=i&&Math.abs(n-s)<=i)return!0;for(const t of r)if($(a,e,n,o,t,i))return!0;return!1},$=(t,a,e,n,o,r)=>{const{x1:i,y1:s,x2:l,y2:c}=o;if(Math.abs(a-n)<r&&Math.abs(s-c)<r){if(Math.abs(a-s)<=r){const a=Math.min(t,e),n=Math.max(t,e),o=Math.min(i,l),s=Math.max(i,l);return o<=a+r&&s>=n-r}}else if(Math.abs(t-e)<r&&Math.abs(i-l)<r&&Math.abs(t-i)<=r){const t=Math.min(a,n),e=Math.max(a,n),o=Math.min(s,c),i=Math.max(s,c);return o<=t+r&&i>=e-r}return!1}}))})();